%% PanTompkin Method

prefix = '/media/shrey/Kirti1/Data_and_Analysis/Resting_MEG_RawTimeSeries/CC';
suffix = '/transdef_mf2pt2_rest_raw.fif';

subjects = [110033;110037;110056;110069;110087;110098;110101;110126;110174;110182;110187;110319;110411;110606;112141;120008;120049;120061;120065;120120;120137;120166;120182;120184;120208;120212;120218;120264;120276;120309;120313;120319;120347;120376;120409;120462;120469;120470;120550;120640;120727;120764;120795;121106;121111;121144;121158;121200;121317;121397;121428;121479;121685;121795;122016;122172;122405;122620;210023;210051;210088;210124;210148;210172;210174;210182;210250;210314;210422;210519;210526;210617;210657;212153;220098;220107;220115;220132;220151;220198;220203;220223;220232;220234;220284;220323;220335;220352;220372;220419;220506;220511;220518;220519;220526;220535;220567;220610;220635;220697;220713;220828;220843;220901;220920;220974;220999;221002;221031;221033;221040;221054;221107;221209;221220;221244;221324;221336;221352;221373;221487;221511;221527;221565;221585;221595;221648;221733;221737;221740;221755;221775;221828;221886;221935;221954;221977;221980;222120;222125;222185;222258;222264;222304;222326;222367;222496;222555;222652;222797;222956;223085;223115;223286;310008;310051;310052;310086;310129;310135;310142;310203;310214;310224;310252;310256;310331;310361;310385;310391;310397;310400;310410;310414;310450;310463;310473;312058;312149;312222;320002;320022;320059;320088;320089;320107;320109;320160;320202;320206;320218;320267;320297;320321;320325;320336;320342;320359;320361;320379;320417;320428;320429;320445;320448;320461;320478;320500;320553;320568;320574;320575;320576;320608;320616;320621;320636;320651;320661;320680;320686;320687;320698;320759;320776;320814;320850;320861;320870;320888;320893;320904;321000;321025;321053;321069;321073;321087;321107;321137;321154;321174;321203;321281;321291;321331;321368;321428;321431;321464;321504;321506;321529;321544;321557;321585;321594;321595;321880;321899;321976;322186;410015;410032;410040;410084;410086;410091;410097;410101;410113;410119;410129;410169;410173;410177;410179;410182;410220;410222;410243;410248;410251;410284;410286;410287;410289;410297;410323;410325;410354;410387;410390;410432;412004;412021;420004;420060;420071;420075;420089;420091;420094;420100;420137;420143;420148;420149;420157;420162;420167;420173;420182;420197;420198;420202;420204;420217;420222;420226;420229;420231;420236;420241;420244;420260;420261;420286;420322;420324;420348;420356;420364;420383;420392;420396;420402;420412;420433;420435;420454;420462;420464;420493;420566;420582;420587;420589;420623;420720;420776;420888;510039;510043;510050;510076;510086;510115;510161;510163;510208;510220;510226;510237;510242;510243;510255;510256;510258;510259;510284;510304;510321;510323;510329;510342;510354;510355;510392;510393;510395;510415;510433;510434;510438;510473;510474;510483;510486;510534;510548;510551;510609;510629;510639;510648;512003;520002;520011;520013;520042;520053;520055;520065;520078;520083;520097;520122;520127;520134;520136;520147;520168;520175;520197;520200;520209;520211;520215;520239;520247;520253;520254;520279;520287;520377;520390;520391;520395;520398;520424;520436;520477;520480;520503;520517;520552;520560;520562;520584;520585;520597;520607;520624;520673;520745;520775;520868;520980;521040;610022;610028;610039;610040;610046;610051;610052;610058;610071;610076;610099;610101;610146;610178;610210;610212;610227;610285;610292;610308;610344;610372;610392;610405;610462;610469;610496;610508;610568;610575;610576;610594;610625;610631;610653;610671;620005;620026;620073;620085;620090;620106;620114;620118;620121;620129;620164;620193;620259;620262;620264;620279;620284;620314;620354;620359;620405;620406;620413;620429;620444;620451;620454;620466;620479;620496;620515;620518;620526;620527;620549;620567;620572;620592;620610;620619;620659;620685;620720;620785;620793;620821;620885;620919;620935;621011;621080;621118;621128;621184;621199;621248;621284;621642;710037;710131;710176;710214;710223;710313;710342;710350;710382;710429;710446;710462;710486;710494;710548;710551;710566;710591;710664;710679;710858;710982;711027;711128;711158;711244;711245;712027;720023;720119;720188;720238;720290;720304;720329;720330;720358;720400;720407;720497;720511;720516;720622;720670;720723;720774;720941;720986;721052;721107;721114;721224;721291;721292;721374;721377;721392;721418;721434;721449;721504;721532;721585;721648;721704;721707;721729;721888;721891;721894;722421;722536;722651;722891;723197;723395];

addpath(genpath('/home/shrey/Old_stuff/pan_tompkin')) %add pan tompkin
addpath(genpath('/home/shrey/Old_stuff/Previous Stuff/Softwares/fieldtrip-20171231')); %add fieldtrip

for ii = 1:length(subjects)
    
    %Loading the raw data
    data = ft_read_data(strcat(prefix, num2str(subjects(ii,1)), suffix));
  
    %Extracting out ECG time series
    ecg = -1 * data(323,:);
    
    [pks,locs] = pan_tompkin(ecg,1000,0);
    
    RpeakLocation{ii,1} = subjects;
    RpeakLocation{ii,2} = pks;
    RpeakLocation{ii,3} = locs;
    
    cd('/media/shrey/Kirti1/CuratedCodes_Project1_July2024/Analysis1-Cardiovascular  Measuresn Across Age/Finding R peak_PanTompkin')
    save RpeakLocation RpeakLocation
  
    ii
end

%% Calculating electrocardiographic paramters - IBI, HRV, HR

for ii = 1:length(subjects)
    
    Rpeaks = RpeakLocation{ii,2};
    IBI = Rpeaks(1,2:end) - Rpeaks(1,1:end-1);
    HRV = std(IBI);
    HR = 60000./ mean(IBI);
    
    InterbeatInterval(ii) = mean(IBI);
    HeartRateVariability(ii) = HRV;
    HeartRate(ii) = HR;
    
    cd('/media/shrey/Kirti1/CuratedCodes_Project1_July2024/Analysis1-Cardiovascular  Measuresn Across Age')
    save InterbeatInterval InterbeatInterval
    save HeartRateVariability HeartRateVariability 
    save HeartRate HeartRate
    ii                                                                                                                                           
end

%% Doing a multivariate regression 
systole= [111.500000000000;NaN;NaN;94.5000000000000;NaN;NaN;108.500000000000;NaN;NaN;NaN;116;104;92.5000000000000;NaN;109.500000000000;115.500000000000;107.500000000000;104;101.500000000000;128.500000000000;NaN;112;113;NaN;100;NaN;104;108.500000000000;103.500000000000;109;113;130;103;107;94;114.500000000000;98.5000000000000;95.5000000000000;116;100.500000000000;125.500000000000;142;107.500000000000;110.500000000000;106.500000000000;106;109.500000000000;126;113.500000000000;121.500000000000;112.500000000000;96;116.500000000000;109;NaN;102.500000000000;126.500000000000;97;118.500000000000;NaN;NaN;NaN;NaN;105.500000000000;NaN;NaN;110.500000000000;92;122.500000000000;104.500000000000;113;102.500000000000;103.500000000000;102;110.500000000000;117;86.5000000000000;139;120;116.500000000000;114;117;120;123.500000000000;109;100.500000000000;108.500000000000;114.500000000000;116;118;103.500000000000;NaN;116.500000000000;140.500000000000;101;125;116.500000000000;106.500000000000;106;119.500000000000;123.500000000000;111;108.500000000000;98;117;126;119.500000000000;104.500000000000;113.500000000000;95;115.500000000000;125.500000000000;115;99;108.500000000000;99;123.500000000000;112;111.500000000000;114.500000000000;137;115;114;103.500000000000;127.500000000000;120.500000000000;107;131.500000000000;NaN;96.5000000000000;108;95.5000000000000;109.500000000000;117.500000000000;118;113;113;109;102.500000000000;103;91.5000000000000;131.500000000000;118;121;133.500000000000;124;115.500000000000;101.500000000000;122;104.500000000000;108;99;133.500000000000;119;NaN;NaN;106.500000000000;NaN;NaN;NaN;NaN;102;118;NaN;NaN;137;119.500000000000;108;133.500000000000;116.500000000000;100.500000000000;121.500000000000;100.500000000000;113;113;101;114.500000000000;114;NaN;100.500000000000;103;112.500000000000;125.500000000000;105.500000000000;107;130;108.500000000000;94.5000000000000;111;136.500000000000;104;126.500000000000;103;149.500000000000;117;112;103;117.500000000000;NaN;98.5000000000000;106.500000000000;100.500000000000;114.500000000000;98;126;122.500000000000;114.500000000000;121.500000000000;136;107.500000000000;113.500000000000;115;111.500000000000;132.500000000000;113;118;124.500000000000;107;104.500000000000;125;108.500000000000;121;135.500000000000;106.500000000000;112;98;118;112;159;103;115;126.500000000000;114;103;112.500000000000;95.5000000000000;121.500000000000;100;126.500000000000;112.500000000000;101;112.500000000000;125.500000000000;95;128.500000000000;100;120;102.500000000000;78.5000000000000;128.500000000000;108.500000000000;112;96.5000000000000;103.500000000000;112.500000000000;106;131.500000000000;118;95;120;122;120;NaN;NaN;NaN;111.500000000000;125;NaN;133;NaN;NaN;NaN;NaN;NaN;126;NaN;110;NaN;NaN;NaN;126.500000000000;109.500000000000;136.500000000000;97;NaN;129.500000000000;128;149.500000000000;105.500000000000;96;125;132.500000000000;135.500000000000;108.500000000000;118.500000000000;120;110;131.500000000000;103.500000000000;131;114;174.500000000000;112.500000000000;124.500000000000;140;99;111;108.500000000000;119;111.500000000000;104.500000000000;105;112;115;138.500000000000;133.500000000000;119;104.500000000000;145.500000000000;113;122;140;105.500000000000;106;NaN;108;109;126;116;NaN;105.500000000000;125;NaN;129;102.500000000000;113;128.500000000000;136;114.500000000000;108;121;125;123.500000000000;138;98.5000000000000;103;115;113.500000000000;103.500000000000;90.5000000000000;96.5000000000000;108;NaN;NaN;NaN;NaN;145.500000000000;NaN;NaN;123;NaN;NaN;120;NaN;NaN;125;114;NaN;102;NaN;NaN;137.500000000000;NaN;NaN;138.500000000000;116.500000000000;102;117.500000000000;150;150;123.500000000000;160;132;126.500000000000;148.500000000000;128.500000000000;123.500000000000;116.500000000000;116.500000000000;120;143;114;130.500000000000;131;159;114;123;112.500000000000;105;131;128.500000000000;109.500000000000;120;120.500000000000;104.500000000000;142;127.500000000000;135.500000000000;119.500000000000;113;134;128.500000000000;122;125.500000000000;104;136.500000000000;102;102;114.500000000000;116;131;109;118.500000000000;118.500000000000;110;123;108.500000000000;103.500000000000;136.500000000000;130;118;108.500000000000;128.500000000000;128.500000000000;128.500000000000;148.500000000000;120;140;132;124;124.500000000000;119;140;105.500000000000;147.500000000000;135;139.500000000000;130;148;100.500000000000;NaN;NaN;NaN;NaN;NaN;110.500000000000;116;NaN;133;NaN;NaN;124;NaN;NaN;NaN;122;162;135;105;NaN;NaN;129;111;160;172;135;156.500000000000;112;119;124.500000000000;156;121;118.500000000000;155;105.500000000000;101.500000000000;140;145.500000000000;158.500000000000;NaN;123;134;117.500000000000;139;123.500000000000;122;131;146;149.500000000000;128.500000000000;126.500000000000;105;155;110;142;95;119;150.500000000000;109;153.500000000000;106;136.500000000000;94.5000000000000;147;143;145;138.500000000000;134.500000000000;117.500000000000;164;115;128;132.500000000000;144.500000000000;166.500000000000;142;106.500000000000;118;123;115;125;103;147.500000000000;126.500000000000;119.500000000000;138;109.500000000000;NaN;119.500000000000;132;120;121;105;115;NaN;112.500000000000;NaN;NaN;NaN;NaN;NaN;109.500000000000;NaN;NaN;112;NaN;117;164.500000000000;NaN;NaN;140.500000000000;121;166;132;138.500000000000;82.5000000000000;100;123;111.500000000000;120.500000000000;124;139.500000000000;166.500000000000;134;174;126;115;96.5000000000000;124;102;108;136;122;141;137.500000000000;132;142;130.500000000000;169.500000000000;124;NaN;148;142;128;112;118;123;116.500000000000;175.500000000000;107.500000000000;121.500000000000;115.500000000000;113.500000000000;134.500000000000;122.500000000000;184.500000000000;120;136;148;105;118.500000000000;134;122;98.5000000000000;162.500000000000;134;122.500000000000;136.500000000000;186;102];
diastole= [66;NaN;NaN;61.5000000000000;NaN;NaN;63;NaN;NaN;NaN;71.5000000000000;50.5000000000000;54;NaN;64.5000000000000;72;69;58;67;76.5000000000000;NaN;63.5000000000000;71;NaN;68;NaN;70;74.5000000000000;69.5000000000000;70.5000000000000;79;95;64.5000000000000;65;51.5000000000000;74.5000000000000;64.5000000000000;57.5000000000000;71;61;87;80.5000000000000;55;75.5000000000000;62.5000000000000;66;63.5000000000000;83.5000000000000;71.5000000000000;82.5000000000000;70;62;56.5000000000000;65.5000000000000;NaN;55.5000000000000;81;53.5000000000000;74.5000000000000;NaN;NaN;NaN;NaN;76.5000000000000;NaN;NaN;81;67.5000000000000;79;69.5000000000000;84.5000000000000;67.5000000000000;52;66.5000000000000;82.5000000000000;64;57;93;72;81.5000000000000;67;74;75;78.5000000000000;70;60.5000000000000;76.5000000000000;63;69;76.5000000000000;55.5000000000000;NaN;70;87;70;81.5000000000000;64.5000000000000;70;81;78.5000000000000;67;66.5000000000000;71;59;86.5000000000000;82.5000000000000;79.5000000000000;73.5000000000000;64.5000000000000;58;74.5000000000000;82.5000000000000;62.5000000000000;65;69;66.5000000000000;82;78;68.5000000000000;69;76.5000000000000;82.5000000000000;73;74.5000000000000;72.5000000000000;68;69.5000000000000;71;NaN;63;70;66.5000000000000;64.5000000000000;70.5000000000000;77;57;78;63.5000000000000;68;67;52.5000000000000;84;82;87;74;85.5000000000000;72.5000000000000;64.5000000000000;80;63.5000000000000;71;62.5000000000000;70;83;NaN;NaN;76;NaN;NaN;NaN;NaN;66.5000000000000;72;NaN;NaN;90;71.5000000000000;82.5000000000000;79.5000000000000;85;74.5000000000000;89.5000000000000;76.5000000000000;80.5000000000000;75.5000000000000;72;73.5000000000000;69.5000000000000;NaN;64.5000000000000;76.5000000000000;65.5000000000000;73.5000000000000;67;65.5000000000000;87.5000000000000;72;56.5000000000000;64.5000000000000;84.5000000000000;75;62.5000000000000;68;91;65.5000000000000;70.5000000000000;71.5000000000000;77;NaN;55.5000000000000;65;62;72.5000000000000;69.5000000000000;86;71.5000000000000;86.5000000000000;73.5000000000000;95;59;69.5000000000000;75;79.5000000000000;82.5000000000000;69.5000000000000;72.5000000000000;73;57;69;62;68.5000000000000;83.5000000000000;94.5000000000000;73;76;61;80.5000000000000;78;105;62;73.5000000000000;94;79;78;75.5000000000000;63;85.5000000000000;72.5000000000000;66.5000000000000;77;71;71.5000000000000;76;64;71.5000000000000;64.5000000000000;70.5000000000000;72;50;88;62;74.5000000000000;53;62.5000000000000;77;70;77;83;50.5000000000000;82.5000000000000;66.5000000000000;68.5000000000000;NaN;NaN;NaN;72.5000000000000;75;NaN;87;NaN;NaN;NaN;NaN;NaN;76;NaN;66.5000000000000;NaN;NaN;NaN;79.5000000000000;81.5000000000000;85.5000000000000;65.5000000000000;NaN;92.5000000000000;80.5000000000000;81;76;70.5000000000000;81;90;80.5000000000000;75;72;75.5000000000000;73;70.5000000000000;75;91;83.5000000000000;115.500000000000;76;84.5000000000000;80;67.5000000000000;57;74;80;82;62.5000000000000;73.5000000000000;67.5000000000000;82;91.5000000000000;95.5000000000000;65;68;80.5000000000000;79.5000000000000;77.5000000000000;94;64;71.5000000000000;NaN;75;76;73;61.5000000000000;NaN;64.5000000000000;78;NaN;80.5000000000000;62;80;77;92;71;75;86.5000000000000;75.5000000000000;74.5000000000000;93.5000000000000;62;66;68;68;69.5000000000000;64;58;79;NaN;NaN;NaN;NaN;79.5000000000000;NaN;NaN;69;NaN;NaN;75.5000000000000;NaN;NaN;73;74;NaN;61;NaN;NaN;75;NaN;NaN;92.5000000000000;67;69.5000000000000;63;96;81;72.5000000000000;92;90;77;95;75;77.5000000000000;80.5000000000000;75;72.5000000000000;91.5000000000000;74.5000000000000;77.5000000000000;78;99;74.5000000000000;75;76.5000000000000;73;78.5000000000000;82;65;60;81;56;80;80;77;66;67;84;74.5000000000000;71.5000000000000;72.5000000000000;67.5000000000000;71;72;52;78.5000000000000;69;88.5000000000000;70.5000000000000;77.5000000000000;78.5000000000000;79.5000000000000;72;59.5000000000000;60.5000000000000;85.5000000000000;78;69.5000000000000;56;85.5000000000000;57.5000000000000;87.5000000000000;100.500000000000;91;86.5000000000000;75;85;82.5000000000000;68;87;79.5000000000000;96.5000000000000;82;83.5000000000000;89.5000000000000;73.5000000000000;69.5000000000000;NaN;NaN;NaN;NaN;NaN;73.5000000000000;78;NaN;73.5000000000000;NaN;NaN;63;NaN;NaN;NaN;79;81;76;52.5000000000000;NaN;NaN;71.5000000000000;64.5000000000000;72;114.500000000000;82;102.500000000000;77.5000000000000;58;75;92;90.5000000000000;70;80.5000000000000;57;62.5000000000000;65.5000000000000;88.5000000000000;81.5000000000000;NaN;70.5000000000000;62;74.5000000000000;87;59;78;77.5000000000000;79.5000000000000;77.5000000000000;73.5000000000000;75;66.5000000000000;88;67;75.5000000000000;61.5000000000000;67.5000000000000;74;63;87;64;78;55;76.5000000000000;86;92.5000000000000;83;66.5000000000000;69.5000000000000;76.5000000000000;67;62.5000000000000;86.5000000000000;80;79;72;65;73;80;64;70;57.5000000000000;74.5000000000000;72;70.5000000000000;76;73;NaN;77;78.5000000000000;66;80.5000000000000;52.5000000000000;68;NaN;59;NaN;NaN;NaN;NaN;NaN;59;NaN;NaN;57.5000000000000;NaN;66;84;NaN;NaN;72;62.5000000000000;78.5000000000000;73.5000000000000;71;50.5000000000000;65.5000000000000;55.5000000000000;58;70.5000000000000;64.5000000000000;65.5000000000000;90.5000000000000;71.5000000000000;81.5000000000000;74.5000000000000;62.5000000000000;59;66.5000000000000;68;62;73;67.5000000000000;84.5000000000000;85.5000000000000;80.5000000000000;61.5000000000000;67;74;49;NaN;82.5000000000000;79.5000000000000;67.5000000000000;63.5000000000000;63.5000000000000;78.5000000000000;56.5000000000000;80.5000000000000;65;59.5000000000000;68;73;77;56;94.5000000000000;71.5000000000000;72;77.5000000000000;56.5000000000000;60.5000000000000;75;66.5000000000000;63;88.5000000000000;59;63.5000000000000;73;94;50.5000000000000];

DepVar(:,1) = systole; 
DepVar(:,2) = diastole;
DepVar(:,3) = InterbeatInterval;
DepVar(:,4)  = HeartRateVariability;
DepVar(:,5) = HeartRate;

IndepVar = [24;18;22;28;28;23;23;22;25;18;25;28;25;20;29;26;28;19;25;25;18;28;26;25;24;20;27;28;23;27;28;27;21;18;18;18;25;28;19;26;23;27;24;28;18;26;28;26;25;27;26;26;20;25;23;27;27;24;31;35;36;35;30;31;30;31;29;34;34;29;37;34;37;29;32;34;29;31;30;37;34;33;36;35;34;33;34;29;37;31;35;32;30;29;28;32;37;32;36;35;33;33;37;35;34;37;37;37;38;28;36;31;35;29;37;32;36;34;37;29;35;36;34;32;37;33;30;36;34;35;32;32;32;33;37;32;37;34;37;34;32;35;37;38;35;37;38;29;30;31;32;38;36;36;45;42;42;47;40;42;48;39;46;47;47;44;46;43;48;41;41;43;41;40;46;45;46;47;45;48;46;40;48;41;47;47;39;48;45;47;47;38;40;40;44;44;40;47;41;48;39;45;48;47;42;42;40;46;48;44;40;39;45;45;39;46;45;42;43;41;40;41;45;44;47;43;47;47;47;47;47;42;40;40;40;41;43;40;44;41;48;39;40;46;44;46;45;42;48;45;42;39;39;44;44;44;43;44;46;49;42;47;51;55;55;57;57;57;49;56;55;57;58;49;55;57;55;53;52;55;56;54;53;50;49;58;58;58;51;54;48;57;56;52;54;54;49;51;52;52;48;52;56;56;56;53;56;52;58;52;51;49;52;55;58;51;53;50;55;50;52;54;53;55;49;50;54;56;49;52;57;54;54;48;51;53;49;52;51;53;54;55;55;51;50;54;49;52;51;50;49;50;60;58;59;62;65;62;58;64;66;66;67;66;60;60;62;63;60;60;60;66;64;64;64;63;62;65;67;68;68;64;61;65;62;65;66;60;63;66;62;61;59;59;62;61;62;64;60;67;58;64;61;60;63;65;62;67;66;67;65;61;59;61;59;67;66;63;63;65;63;58;66;68;59;63;65;64;61;59;63;63;66;60;66;65;64;65;66;59;68;64;64;60;67;63;61;67;68;63;68;68;70;72;72;68;77;73;69;77;69;68;76;72;75;77;76;71;72;69;71;70;75;72;76;73;70;77;76;71;72;69;70;77;71;70;74;70;69;70;71;71;73;71;68;75;72;76;68;69;76;77;75;74;78;68;76;68;76;69;77;75;75;75;69;70;75;78;73;69;73;74;78;74;76;71;71;77;78;69;71;70;78;78;71;76;70;76;75;69;72;72;79;73;78;85;78;79;79;81;83;81;83;80;85;82;79;80;83;85;83;85;82;84;79;79;80;80;80;85;85;87;82;79;78;80;84;80;80;80;83;86;82;80;79;84;81;79;84;87;79;83;79;79;79;87;80;79;86;80;80;79;84;80;82;87;79;80;82;80;81;78;83;80;79;79;79;84;80;86];

 [BETA,SIGMA,RESID] = mvregress(IndepVar,DepVar );

 % Plotting
 figure; plot(IndepVar,DepVar,'x');
 
 %(Yet to make sense out of this)
 %% 

 mdl_multivariate = fitlm(DepVar,IndepVar);
 