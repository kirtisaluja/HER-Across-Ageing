%% Heartbeat evoked responses across age and gender 

%% Age as a factor 
prefix = '/media/shrey/Kirti/Data_and_Analysis/july_third_final_attempt/';
suffix = '/ica_raw.fif';
subjects = ['CC110033','CC110037','CC110056','CC110069','CC110087','CC110098','CC110101','CC110126','CC110182','CC110187','CC110319','CC110411','CC112141','CC120008','CC120049','CC120065','CC120137','CC120166','CC120182','CC120212','CC120218','CC120276','CC120309','CC120313','CC120347','CC120376','CC120462','CC120469','CC120470','CC120550','CC120640','CC120795','CC121106','CC121111','CC121144','CC121200','CC121317','CC121397','CC121428','CC121479','CC121685','CC121795','CC122172','CC122405','CC122620','CC210023','CC210051','CC210088','CC210124','CC210148','CC210174','CC210422','CC210519','CC210526','CC210617','CC210657','CC212153','CC220098','CC220115','CC220132','CC220372','CC220419','CC220506','CC220511','CC220535','CC220567','CC220635','CC220713','CC220901','CC221031','CC221565','CC221585','CC221595','CC221648','CC221740','CC221755','CC221775','CC221828','CC221886','CC221935','CC221954','CC221977','CC221980','CC222120','CC222125','CC222264','CC222304','CC222326','CC222367','CC222496','CC222555','CC222652','CC222797','CC222956','CC223115','CC310008','CC310051','CC310052','CC310086','CC310135','CC310142','CC310214','CC310224','CC310331','CC310361','CC310385','CC310391','CC310397','CC310400','CC310410','CC310414','CC310473','CC312222','CC320002','CC320088','CC320089','CC320107','CC320160','CC320202','CC320206','CC320267','CC320297','CC320321','CC320336','CC320342','CC320361','CC320417','CC320448','CC320461','CC320568','CC320574','CC320575','CC320576','CC320616','CC320680','CC320686','CC320687','CC320698','CC320759','CC320814','CC320850','CC320861','CC320893','CC321000','CC321025','CC321053','CC321073','CC321107','CC321137','CC321154','CC321174','CC321203','CC321281','CC321291','CC321331','CC321428','CC321431','CC321464','CC321506','CC321529','CC321544','CC321557','CC321594','CC321595','CC321880','CC321899','CC321976','CC410015','CC410040','CC410084','CC410086','CC410091','CC410094','CC410101','CC410113','CC410121','CC410169','CC410173','CC410177','CC410179','CC410222','CC410243','CC410248','CC410286','CC410289','CC410297','CC410323','CC410325','CC410387','CC410390','CC410432','CC412004','CC412021','CC420004','CC420060','CC420094','CC420100','CC420143','CC420148','CC420149','CC420157','CC420162','CC420167','CC420173','CC420182','CC420197','CC420226','CC420261','CC420322','CC420348','CC420383','CC420392','CC420396','CC420402','CC420433','CC420435','CC420454','CC420493','CC420566','CC420582','CC420589','CC420623','CC420720','CC420888','CC510115','CC510161','CC510163','CC510208','CC510220','CC510242','CC510243','CC510259','CC510284','CC510321','CC510323','CC510329','CC510392','CC510434','CC510474','CC510486','CC510534','CC510548','CC510551','CC510629','CC520042','CC520055','CC520078','CC520097','CC520122','CC520134','CC520175','CC520200','CC520209','CC520254','CC520377','CC520395','CC520398','CC520436','CC520480','CC520503','CC520517','CC520552','CC520584','CC520597','CC520607','CC520673','CC520868','CC520980','CC521040','CC610028','CC610040','CC610052','CC610099','CC610101','CC610308','CC610344','CC610405','CC610469','CC610508','CC610575','CC620026','CC620073','CC620090','CC620114','CC620259','CC620279','CC620359','CC620429','CC620436','CC620451','CC620454','CC620479','CC720238','CC720304','CC720329','CC720358','CC720670','CC721107','CC721291','CC721292','CC721392','CC721418','CC721434','CC721532','CC721648','CC721707','CC721729','CC721888'];

addpath(genpath('/home/shrey/Old_stuff/Previous Stuff/Softwares/fieldtrip-20171231')); %add fieldtrip
addpath(genpath('/home/shrey/Old_stuff/pan_tompkin'));

prefix_meg = '/media/shrey/Kirti/Data_and_Analysis/july_third_final_attempt/';
suffix_meg = '/ica_raw.fif';

prefix_ecg = '/home/shrey/Data/Resting_MEG_RawTimeSeries/';
suffix_ecg = '/transdef_mf2pt2_rest_raw.fif';

subjects = {'CC110037';'CC110182';'CC120137';'CC120376';'CC120462';'CC121111';'CC120550';'CC120212';'CC121685';'CC120347';'CC110056';'CC110126';'CC110098';'CC110101';'CC120276';'CC110033';'CC120795';'CC122620';'CC110187';'CC110411';'CC120065';'CC120469';'CC121317';'CC121795';'CC120008';'CC120182';'CC120640';'CC121144';'CC121200';'CC121428';'CC121479';'CC120218';'CC120309';'CC121397';'CC122172';'CC122405';'CC110069';'CC110087';'CC110319';'CC120049';'CC120166';'CC120313';'CC120470';'CC121106';'CC112141';'CC210519';'CC212153';'CC220115';'CC222555';'CC210148';'CC210174';'CC221648';'CC222652';'CC210023';'CC220132';'CC220419';'CC222797';'CC220098';'CC220511';'CC220535';'CC221565';'CC221755';'CC221775';'CC221828';'CC221954';'CC222956';'CC220713';'CC221595';'CC221886';'CC210422';'CC210617';'CC221980';'CC222125';'CC210051';'CC210124';'CC220506';'CC220901';'CC221740';'CC222326';'CC210088';'CC220635';'CC223115';'CC210526';'CC210657';'CC220372';'CC220567';'CC221585';'CC221935';'CC221977';'CC222120';'CC222264';'CC222367';'CC221031';'CC222304';'CC222496';'CC320267';'CC320417';'CC320575';'CC320616';'CC321174';'CC321506';'CC321529';'CC310414';'CC320297';'CC320321';'CC320342';'CC320574';'CC320686';'CC321000';'CC321025';'CC321053';'CC321203';'CC310391';'CC310397';'CC310410';'CC320088';'CC320361';'CC320680';'CC320687';'CC321137';'CC310051';'CC310052';'CC310135';'CC320448';'CC320461';'CC321428';'CC321976';'CC310361';'CC310400';'CC320814';'CC321073';'CC321594';'CC320336';'CC320568';'CC320759';'CC321107';'CC321291';'CC321544';'CC321557';'CC321595';'CC310008';'CC320202';'CC320576';'CC320698';'CC321464';'CC310214';'CC310331';'CC310473';'CC320002';'CC321281';'CC321331';'CC321880';'CC310086';'CC310224';'CC320089';'CC320107';'CC320206';'CC320850';'CC320861';'CC320893';'CC310142';'CC310385';'CC312222';'CC320160';'CC321154';'CC321431';'CC420383';'CC321899';'CC410169';'CC410286';'CC420004';'CC420173';'CC420322';'CC420402';'CC420226';'CC420566';'CC420720';'CC420888';'CC410015';'CC410323';'CC420060';'CC420167';'CC420392';'CC420433';'CC420493';'CC420623';'CC410121';'CC410432';'CC420149';'CC420162';'CC420182';'CC420589';'CC420143';'CC420396';'CC420435';'CC410094';'CC410248';'CC410325';'CC412004';'CC412021';'CC420261';'CC420454';'CC420582';'CC410040';'CC410113';'CC410173';'CC410179';'CC410222';'CC420197';'CC410101';'CC410243';'CC410390';'CC420094';'CC420100';'CC420148';'CC410084';'CC410086';'CC410091';'CC410177';'CC410387';'CC420348';'CC410289';'CC410297';'CC420157';'CC510161';'CC520042';'CC510629';'CC520398';'CC520584';'CC510242';'CC510243';'CC510259';'CC510284';'CC520480';'CC510551';'CC520055';'CC520175';'CC520395';'CC510115';'CC510548';'CC520097';'CC510486';'CC520078';'CC520377';'CC520436';'CC521040';'CC510163';'CC510321';'CC510323';'CC520552';'CC520597';'CC520607';'CC510434';'CC520517';'CC510208';'CC510220';'CC510474';'CC510534';'CC520209';'CC520254';'CC520503';'CC510329';'CC510392';'CC520122';'CC520134';'CC520200';'CC520673';'CC520868';'CC520980';'CC610028';'CC610101';'CC620259';'CC620359';'CC610099';'CC610308';'CC620073';'CC620429';'CC620479';'CC620026';'CC610344';'CC610575';'CC620090';'CC610040';'CC610405';'CC610469';'CC620114';'CC620451';'CC620454';'CC610052';'CC610508';'CC620279';'CC620436';'CC721888';'CC720670';'CC721107';'CC721292';'CC721418';'CC720238';'CC720304';'CC720329';'CC721291';'CC721392';'CC721648';'CC721707';'CC721729';'CC720358';'CC721434';'CC721532'};
subCC_restof_344 = {'CC110045';'CC110174';'CC110606';'CC120061';'CC120120';'CC120184';'CC120208';'CC120264';'CC120319';'CC120409';'CC120727';'CC120764';'CC121158';'CC121411';'CC121479';'CC122016';'CC210172';'CC210182';'CC210250';'CC210314';'CC220107';'CC220151';'CC220198';'CC220203';'CC220223';'CC220232';'CC220234';'CC220284';'CC220323';'CC220335';'CC220352';'CC220518';'CC220519';'CC220526';'CC220610';'CC220697';'CC220828';'CC220843';'CC220920';'CC220974';'CC220999';'CC221002';'CC221033';'CC221040';'CC221054';'CC221107';'CC221209';'CC221220';'CC221244';'CC221324';'CC221336';'CC221352';'CC221373';'CC221487';'CC221511';'CC221527';'CC221733';'CC221737';'CC222185';'CC222258';'CC223085';'CC223286';'CC310129';'CC310160';'CC310203';'CC310252';'CC310256';'CC310450';'CC310463';'CC312058';'CC312149';'CC320022';'CC320059';'CC320109';'CC320218';'CC320325';'CC320359';'CC320379';'CC320428';'CC320429';'CC320445';'CC320478';'CC320500';'CC320553';'CC320608';'CC320621';'CC320636';'CC320651';'CC320661';'CC320776';'CC320870';'CC320888';'CC320904';'CC321069';'CC321087';'CC321368';'CC321504';'CC321585';'CC322186';'CC410032';'CC410094';'CC410097';'CC410119';'CC410129';'CC410182';'CC410220';'CC410226';'CC410251';'CC410284';'CC410287';'CC410354';'CC420061';'CC420071';'CC420075';'CC420089';'CC420091';'CC420137';'CC420180';'CC420198';'CC420202';'CC420204';'CC420217';'CC420222';'CC420229';'CC420231';'CC420236';'CC420241';'CC420244';'CC420260';'CC420286';'CC420324';'CC420356';'CC420364';'CC420412';'CC420462';'CC420464';'CC420587';'CC420776';'CC510039';'CC510043';'CC510050';'CC510076';'CC510086';'CC510226';'CC510237';'CC510255';'CC510256';'CC510258';'CC510304';'CC510342';'CC510354';'CC510355';'CC510393';'CC510395';'CC510415';'CC510433';'CC510438';'CC510473';'CC510480';'CC510483';'CC510609';'CC510639';'CC510648';'CC512003';'CC520002';'CC520011';'CC520013';'CC520053';'CC520065';'CC520083';'CC520127';'CC520136';'CC520147';'CC520168';'CC520197';'CC520211';'CC520215';'CC520239';'CC520247';'CC520253';'CC520279';'CC520287';'CC520390';'CC520391';'CC520424';'CC520477';'CC520560';'CC520562';'CC520585';'CC520624';'CC520745';'CC520775';'CC610022';'CC610039';'CC610046';'CC610050';'CC610051';'CC610058';'CC610061';'CC610071';'CC610076';'CC610146';'CC610178';'CC610210';'CC610212';'CC610227';'CC610285';'CC610288';'CC610292';'CC610372';'CC610392';'CC610462';'CC610496';'CC610568';'CC610576';'CC610594';'CC610625';'CC610631';'CC610653';'CC610658';'CC610671';'CC620005';'CC620044';'CC620085';'CC620106';'CC620118';'CC620121';'CC620129';'CC620152';'CC620164';'CC620193';'CC620262';'CC620264';'CC620284';'CC620314';'CC620354';'CC620405';'CC620406';'CC620413';'CC620436';'CC620444';'CC620466';'CC620490';'CC620496';'CC620499';'CC620515';'CC620518';'CC620526';'CC620527';'CC620549';'CC620557';'CC620567';'CC620572';'CC620592';'CC620610';'CC620619';'CC620659';'CC620685';'CC620720';'CC620785';'CC620793';'CC620821';'CC620885';'CC620919';'CC620935';'CC621011';'CC621080';'CC621118';'CC621128';'CC621184';'CC621199';'CC621248';'CC621284';'CC621642';'CC710037';'CC710088';'CC710131';'CC710154';'CC710176';'CC710214';'CC710223';'CC710313';'CC710342';'CC710350';'CC710382';'CC710429';'CC710446';'CC710462';'CC710486';'CC710494';'CC710548';'CC710551';'CC710566';'CC710591';'CC710664';'CC710679';'CC710858';'CC710982';'CC711027';'CC711035';'CC711128';'CC711158';'CC711244';'CC711245';'CC712027';'CC720023';'CC720071';'CC720103';'CC720119';'CC720188';'CC720290';'CC720330';'CC720400';'CC720407';'CC720497';'CC720511';'CC720516';'CC720622';'CC720646';'CC720685';'CC720723';'CC720774';'CC720941';'CC720986';'CC721052';'CC721114';'CC721224';'CC721374';'CC721377';'CC721449';'CC721504';'CC721519';'CC721585';'CC721704';'CC721891';'CC721894';'CC722077';'CC722421';'CC722536';'CC722542';'CC722651';'CC722891';'CC723197';'CC723395'};

for ii = 1:length(subjects)
    
    ica = ft_read_data(strcat(prefix_meg, subjects{ii,1}, suffix_meg)); %ica
    meg = detrend(ica'); 
        
    raw = ft_read_data(strcat(prefix_ecg, subjects{ii,1}, suffix_ecg)); %raw 
    ecg = -1 * raw(323,:); %raw ecg
    ecg_dt = detrend(ecg);
    [pks,locs]= pan_tompkin(ecg_dt(1,:),1000,0);
    r_peak = locs(1,3:352)'; %time stamps used for epoching
    
    for tr = 1:350
        epochs(:,:,tr) = (meg(r_peak(tr,1) - 200 : r_peak(tr,1) + 799,:)); %% Time stamps according to the cardiac cycle
    end
    
    cd('/media/shrey/Kirti/Data_and_Analysis/august_final_analysis_2022/HEP_sensor')
    savefile = strcat('sub-', subjects{ii,1});
    save(savefile, 'epochs')    

    ii
end

% Similarly for the rest of the 344 subjects 
% The data is saved this directory: /media/shrey/Kirti/Data_and_Analysis/august_final_analysis_2022/HEP_sensor

% Plotting 

young = [110037;110182;120137;120376;120409;120462;121111;120061;120550;110606;120212;121685;120347;110056;110126;110098;110101;120276;120727;122016;110033;120208;120795;122620;110174;110187;110411;120065;120120;120184;120469;121317;121795;120008;120182;120640;121144;121200;121428;121479;120218;120309;120319;120764;121397;122172;122405;110069;110087;110319;120049;120166;120264;120313;120470;121106;121158;220526;221033;112141;210250;210519;212153;220115;220352;220519;221209;221373;222555;210148;210174;220151;220518;221648;222652;210023;210172;210182;220132;220419;221054;222797;220098;220511;220535;220610;221244;221565;221755;221775;221828;221954;222185;222956;220223;220323;220713;220828;221595;221886;210314;210422;210617;220107;220203;220284;220335;220920;221336;221527;221737;221980;222125;210051;210124;220234;220506;220697;220901;221107;221487;221740;222258;222326;210088;220232;220635;221040;221324;221511;221733;223115;223286;210526;210657;220198;220372;220567;220843;220974;220999;221002;221220;221352;221585;221935;221977;222120;222264;222367;221031;222304;222496;223085;320267;310203;320109;320417;320575;320616;321174;321506;321529;310129;310414;320022;320297;320321;320342;320478;320574;320686;321000;321025;321053;321087;321203];
middle = [310391;310397;310410;320088;320361;320680;320687;321069;321137;310051;310052;310135;320448;320461;320651;320904;321428;321504;321976;310361;310400;320661;320814;321073;321594;310256;320325;320336;320568;320759;321107;321291;321544;321557;321585;321595;310008;310463;312149;320202;320428;320576;320608;320636;320698;321368;321464;310214;310331;310450;310473;320002;320500;320621;321281;321331;321880;310086;310224;310252;312058;320089;320107;320206;320218;320359;320445;320776;320850;320861;320870;320888;320893;322186;310142;310385;312222;320059;320160;320379;320429;320553;321154;321431;410354;420089;420383;321899;410097;410169;410286;420004;420173;420244;420322;420402;420587;420776;410284;420217;420226;420260;420566;420720;420888;410015;410323;420060;420167;420202;420392;420433;420493;420623;410220;410432;420071;420075;420091;420149;420162;420182;420229;420324;420412;420589;410182;410251;420143;420204;420236;420396;420435;410248;410325;412004;412021;420231;420261;420356;420364;420454;420582;410032;410040;410113;410173;410179;410222;420197;420222;420241;420462;420464;410101;410243;410390;420094;420100;420137;420148;420286;410084;410086;410091;410119;410177;410387;420348;410129;410287;410289;410297;420157;420198;510043;510161;520042;520253;510050;510609;510629;520168;520197;520287;520398;520584;510039;510242;510243;510258;510259;510284;510483;520011;520065;520480;520624];
old = [510433;510551;510648;520055;520147;520175;520395;520775;510076;510115;510255;510354;510438;510548;510639;512003;520097;510256;510342;510486;520078;520211;520215;520247;520377;520424;520436;520745;521040;510163;510321;510323;510329;510415;520002;520053;520391;520552;520597;520607;510086;510355;510434;510473;520083;520136;520239;520390;520517;520560;510208;510220;510237;510304;510474;510534;520127;520209;520254;520477;520503;520562;510226;510392;520013;520122;520134;520200;520673;520868;510393;510395;520279;520585;520980;610022;610028;610051;610101;620121;620259;620359;620406;610071;610099;610308;610594;620073;620262;620429;620479;620527;620785;621184;610039;610372;610496;610625;610671;620026;620085;620496;620821;621080;610285;610344;610575;610653;620090;620106;620118;620619;620659;620793;620935;610040;610046;610178;610292;610405;610576;620164;621199;621248;610058;610469;620114;620526;620549;621642;620005;620314;620567;620592;610210;610392;620129;620284;620451;620454;620466;620515;621128;610146;610227;610462;610568;620193;620264;620405;620413;620610;621011;621118;610052;610076;610212;610508;610631;620279;620444;620685;620354;620518;620572;620720;620885;620919;710037;710176;720188;721888;621284;710214;710223;710486;710858;710982;720119;720511;720670;720941;721052;721107;721114;721292;721418;721585;722421;722536;722651;710429;710494;711027;711128;711158;720238;720304;720329;720330;720497;721291;721377;721392;721449;721648;721707;721894;723197;710313;710350;720622;721729;710462;710664;720023;720407;721504;721704;710342;710382;710548;710566;720358;720986;721891;710679;720290;720516;720723;721434;722891;710131;710446;710551;710591;711244;711245;720400;721374;723395;712027;720774;721224;721532];

prefix = 'D:\Data_and_Analysis\august_final_analysis_2022\HEP_sensor\sub-CC';
suffix = '.mat';

%Young
for ii = 1:length(young)
   load(strcat(prefix,num2str(young(ii)),suffix));
   erp{ii} = mean(epochs,3);
   YoungHERs = cat(3,erp{:});
   ii
end

figure;plot(mean(mean(YoungHERs,3),2));

% Middle
for ii = 1:length(middle)
   load(strcat(prefix,num2str(middle(ii)),suffix));
   erp{ii} = mean(epochs,3);
   MiddleHERs = cat(3,erp{:});
   ii
end
hold on; plot(mean(mean(MiddleHERs,3),2));

% Old
for ii = 1:length(old)
   load(strcat(prefix,num2str(old(ii)),suffix));
   erp{ii} = mean(epochs,3);
   OldHERs = cat(3,erp{:});
   ii
end
hold on; plot(mean(mean(OldHERs,3),2));

%% Gender as a factor 

